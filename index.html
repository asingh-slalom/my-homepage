<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Homepage</title>
    <link rel="stylesheet" href="style.css">
    <script>
        function abductMe() {
            const profilePic = document.getElementById('profile-pic');
            const wrapper = profilePic.parentElement;
            
            // Add abduction class to trigger animation
            profilePic.classList.add('being-abducted');
            
            // Create tractor beam effect
            const beam = document.createElement('div');
            beam.className = 'tractor-beam';
            wrapper.appendChild(beam);
            
            // Remove effects after animation
            setTimeout(() => {
                profilePic.classList.remove('being-abducted');
                if (beam.parentNode) {
                    beam.parentNode.removeChild(beam);
                }
            }, 4000);
        }
        
        function toggleMusic() {
            const music = document.getElementById('alien-music');
            const btn = document.getElementById('music-btn');
            if (music.paused) {
                music.play().then(() => {
                    music.volume = 0.3;
                    btn.innerHTML = 'ğŸ”Š Alien Vibes';
                }).catch(e => {
                    btn.innerHTML = 'ï¿½ Alien Vibes';
                });
            } else {
                music.pause();
                btn.innerHTML = 'ğŸ”‡ Alien Vibes';
            }
        }
        
        // Auto-play music when page loads (some browsers block this)
        window.addEventListener('load', function() {
            const music = document.getElementById('alien-music');
            music.play().then(() => {
                music.volume = 0.3;
            }).catch(e => {
                console.log('Autoplay blocked by browser');
            });
        });
    </script>
</head>
<body>
<!-- Background alien music -->
<audio autoplay loop id="alien-music">
    <source src="Alien_World.ogg" type="audio/ogg">
    Your browser does not support the audio element.
</audio>

<div class="spaceship-bg">
    <span class="spaceship" style="left: 10%; animation-delay: 0s;">ğŸ›¸</span>
    <span class="spaceship" style="left: 30%; animation-delay: 1s;">ğŸ›¸</span>
    <span class="spaceship" style="left: 55%; animation-delay: 2s;">ğŸ›¸</span>
    <span class="spaceship" style="left: 75%; animation-delay: 0.5s;">ğŸ›¸</span>
    <span class="spaceship" style="left: 85%; animation-delay: 1.5s;">ğŸ›¸</span>
</div>
<div class="container">
    <div class="intro">
        <h1>Moo to the Moon!</h1>
        <div class="profile-pic-wrapper">
            <img src="profile.jpg" alt="My Photo" class="profile-pic" id="profile-pic">
        </div>
        <button class="contact-btn" onclick="abductMe()">Abduct Me</button>
        <button class="music-btn" onclick="toggleMusic()" id="music-btn">ğŸ”Š Alien Vibes</button>
    </div>
</div>
<div class="dancing-cows">
    <span class="cow">ğŸ„</span>
    <span class="cow">ğŸ„</span>
    <span class="cow">ğŸ„</span>
    <span class="cow">ğŸ„</span>
    <span class="cow">ğŸ„</span>
</div>
<section id="weather-widget" style="position:fixed;top:20px;right:20px;max-width:250px;padding:1em;background:rgba(255,255,255,0.95);border:2px solid #4CAF50;border-radius:12px;text-align:center;box-shadow:0 4px 8px rgba(0,0,0,0.2);z-index:1000;font-family:Arial,sans-serif;">
    <h3 style="margin:0 0 10px 0;color:#333;font-size:16px;">ğŸŒ¤ï¸ Weather</h3>
    <div id="weather-info" style="color:#666;font-size:14px;">Loading weather...</div>
    <button id="location-btn" style="display:none;margin-top:8px;padding:4px 8px;background:#4CAF50;color:white;border:none;border-radius:4px;font-size:12px;cursor:pointer;" onclick="getUserLocation()">ğŸ“ Get My Weather</button>
</section>
<div class="grass"></div>
</body>
<script>
// Simple weather widget using Open-Meteo API (no API key required)
async function fetchWeather(lat, lon) {
    const url = `https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lon}&current_weather=true&temperature_unit=fahrenheit`;
    const res = await fetch(url);
    if (!res.ok) throw new Error('Weather fetch failed');
    const data = await res.json();
    return data.current_weather;
}

async function showWeatherWithLocation({ temperature, weathercode }, lat, lon) {
    const weatherCodes = {
        0: 'Clear', 1: 'Mainly clear', 2: 'Partly cloudy', 3: 'Overcast',
        45: 'Fog', 48: 'Depositing rime fog', 51: 'Drizzle', 53: 'Drizzle', 55: 'Drizzle',
        61: 'Rain', 63: 'Rain', 65: 'Rain', 71: 'Snow', 73: 'Snow', 75: 'Snow',
        80: 'Rain showers', 81: 'Rain showers', 82: 'Rain showers',
    };
    let locationName = '';
    try {
        const geoRes = await fetch(`https://nominatim.openstreetmap.org/reverse?lat=${lat}&lon=${lon}&format=json`);
        if (geoRes.ok) {
            const geoData = await geoRes.json();
            if (geoData.address) {
                locationName = geoData.address.city || geoData.address.town || geoData.address.village || geoData.address.hamlet || geoData.address.state || geoData.address.county || geoData.address.country || '';
                if (geoData.address.state && locationName !== geoData.address.state) {
                    locationName += ', ' + geoData.address.state;
                }
            }
        }
    } catch (e) {
        locationName = '';
    }
    document.getElementById('weather-info').innerHTML =
        `<strong style="font-size:18px;color:#333;">${temperature}Â°F</strong><br><span style="color:#666;">${weatherCodes[weathercode] || 'Unknown'}</span>` +
        (locationName ? `<br><small style="color:#999;">${locationName}</small>` : '');
}

function showError(message = 'Unable to load weather.') {
    document.getElementById('weather-info').innerHTML = `<span style="color:#e74c3c;">${message}</span>`;
}

// Try to get weather with fallback to default location (New York) if geolocation fails
async function initWeather() {
    try {
        // Always start with fallback weather (NYC) and show location button
        await fallbackWeather();
        
        // Show the "Get My Weather" button for user-initiated geolocation
        if (navigator.geolocation) {
            document.getElementById('location-btn').style.display = 'block';
        }
    } catch (error) {
        console.log('Init weather failed:', error);
        showError('Weather unavailable');
    }
}

async function getUserLocation() {
    const btn = document.getElementById('location-btn');
    btn.textContent = 'ğŸ“ Loading...';
    btn.disabled = true;
    
    try {
        if (navigator.geolocation) {
            navigator.geolocation.getCurrentPosition(
                async pos => {
                    try {
                        const weather = await fetchWeather(pos.coords.latitude, pos.coords.longitude);
                        await showWeatherWithLocation(weather, pos.coords.latitude, pos.coords.longitude);
                        btn.style.display = 'none'; // Hide button after successful location fetch
                    } catch (error) {
                        console.log('Weather fetch failed:', error);
                        btn.textContent = 'âŒ Failed';
                        setTimeout(() => {
                            btn.textContent = 'ğŸ“ Get My Weather';
                            btn.disabled = false;
                        }, 2000);
                    }
                },
                error => {
                    console.log('Geolocation failed:', error);
                    btn.textContent = 'âŒ Location Denied';
                    setTimeout(() => {
                        btn.textContent = 'ğŸ“ Get My Weather';
                        btn.disabled = false;
                    }, 2000);
                },
                { 
                    timeout: 10000,
                    enableHighAccuracy: true,
                    maximumAge: 300000 // 5 minutes
                }
            );
        } else {
            btn.textContent = 'âŒ Not Supported';
        }
    } catch (error) {
        console.log('Get location failed:', error);
        btn.textContent = 'âŒ Error';
        setTimeout(() => {
            btn.textContent = 'ğŸ“ Get My Weather';
            btn.disabled = false;
        }, 2000);
    }
}

async function fallbackWeather() {
    try {
        // Use New York coordinates as fallback
        const lat = 40.7128, lon = -74.0060;
        const weather = await fetchWeather(lat, lon);
        
        // Show weather with a note that it's using default location
        const weatherCodes = {
            0: 'Clear', 1: 'Mainly clear', 2: 'Partly cloudy', 3: 'Overcast',
            45: 'Fog', 48: 'Depositing rime fog', 51: 'Drizzle', 53: 'Drizzle', 55: 'Drizzle',
            61: 'Rain', 63: 'Rain', 65: 'Rain', 71: 'Snow', 73: 'Snow', 75: 'Snow',
            80: 'Rain showers', 81: 'Rain showers', 82: 'Rain showers',
        };
        
        document.getElementById('weather-info').innerHTML =
            `<strong style="font-size:18px;color:#333;">${weather.temperature}Â°F</strong><br>` +
            `<span style="color:#666;">${weatherCodes[weather.weathercode] || 'Unknown'}</span><br>` +
            `<small style="color:#999;">New York, NY</small>`;
            
    } catch (error) {
        console.log('Fallback weather failed:', error);
        showError('Weather service unavailable');
    }
}

// Initialize weather when page loads
initWeather();
</script>
